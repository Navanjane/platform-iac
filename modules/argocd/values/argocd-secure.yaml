global:
  domain: plat.navanjane.com  # Will be overridden by Terraform

server:
  service:
    type: ClusterIP  # Changed from LoadBalancer - using Ingress instead

  # Configure for path-based routing
  extraArgs:
    - --basehref=/argocd
    - --rootpath=/argocd

  ingress:
    enabled: true  # Enable ingress managed by Helm chart
    ingressClassName: alb

    annotations:
      # ALB Configuration
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/group.name: platform-alb-dev

      # SSL/TLS Configuration
      alb.ingress.kubernetes.io/certificate-arn: ""  # Will be overridden by Terraform
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
      alb.ingress.kubernetes.io/ssl-redirect: "443"
      alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS13-1-2-2021-06

      # Backend Protocol
      alb.ingress.kubernetes.io/backend-protocol: HTTPS

      # Health Check
      alb.ingress.kubernetes.io/healthcheck-path: /argocd/healthz
      alb.ingress.kubernetes.io/healthcheck-port: "8080"
      alb.ingress.kubernetes.io/healthcheck-protocol: HTTPS
      alb.ingress.kubernetes.io/healthcheck-interval-seconds: "15"
      alb.ingress.kubernetes.io/healthcheck-timeout-seconds: "5"
      alb.ingress.kubernetes.io/healthy-threshold-count: "2"
      alb.ingress.kubernetes.io/unhealthy-threshold-count: "2"
      alb.ingress.kubernetes.io/success-codes: "200,404"

      # ALB Attributes
      alb.ingress.kubernetes.io/load-balancer-attributes: idle_timeout.timeout_seconds=60,routing.http2.enabled=true,routing.http.drop_invalid_header_fields.enabled=true

      # Tags
      alb.ingress.kubernetes.io/tags: Name=platform-alb,Application=argocd,ManagedBy=terraform

    # No hostname restriction - allows access via ALB hostname or custom domain
    hosts: []

    paths:
      - /argocd

    pathType: Prefix

  # Resource limits for server
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

configs:
  params:
    server.insecure: false     # Enable TLS termination awareness
    server.rootpath: "/argocd" # Base path for path-based routing
    server.basehref: "/argocd" # Base URL path

  cm:
    create: true
    application.instanceLabelKey: argocd.argoproj.io/instance

  rbac:
    create: true
    policy.default: role:readonly

dex:
  enabled: false

redis:
  enabled: true

controller:
  replicas: 1

  # Resource limits for controller
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi

repoServer:
  replicas: 1

  # Resource limits for repo server
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
